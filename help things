import pygame
import random
import sys
import time

pygame.init()

WIDTH = 800
HEIGHT = 600
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Falling Letters Helper")

font = pygame.font.Font(None, 50)

GREEN = (0, 255, 0)
BLUE = (0, 150, 255)
BLACK = (0, 0, 0)
BG_COLOR = (30, 30, 60)

normal_speed = 2
fall_speed = normal_speed
slow_mode = False
slow_start_time = 0
slow_duration = 10  

class Circle:
    def __init__(self, x, y, color, letter):
        self.x = x
        self.y = y
        self.color = color
        self.letter = letter
        self.radius = 30

    def draw(self):
        pygame.draw.circle(screen, self.color, (self.x, int(self.y)), self.radius)

        text = font.render(self.letter, True, BLACK)
        text_rect = text.get_rect(center=(self.x, int(self.y)))
        screen.blit(text, text_rect)

    def update(self):
        self.y += fall_speed

circles = []

last_green_time = 0
last_blue_time = 0

clock = pygame.time.Clock()


running = True
while running:
    screen.fill(BG_COLOR)
    current_time = time.time()

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()

        if event.type == pygame.KEYDOWN:
            key_pressed = event.unicode.upper()

            for circle in circles[:]:
                if key_pressed == circle.letter:
                    if circle.color == GREEN: #คำตกช้า
                        slow_mode = True
                        slow_start_time = time.time()
                        fall_speed = 0.5

                    elif circle.color == BLUE: #เคลียร์คำที่กำลังหล่น
                        circles.clear()
                        break 

                    circles.remove(circle)

    if slow_mode:
        if time.time() - slow_start_time >= slow_duration:
            slow_mode = False
            fall_speed = normal_speed

    if current_time - last_green_time > 30:
        letter = chr(random.randint(65, 90)) 
        green_circle = Circle(random.randint(50, WIDTH - 50), 0, GREEN, letter)
        circles.append(green_circle)
        last_green_time = current_time

    if current_time - last_blue_time > 60:
        letter = chr(random.randint(65, 90))
        blue_circle = Circle(random.randint(50, WIDTH - 50), 0, BLUE, letter)
        circles.append(blue_circle)
        last_blue_time = current_time

    for circle in circles[:]:
        circle.update()
        circle.draw()

        if circle.y - circle.radius > HEIGHT:
            circles.remove(circle)

    pygame.display.update()
    clock.tick(60)
